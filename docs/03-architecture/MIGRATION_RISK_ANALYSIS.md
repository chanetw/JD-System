# ЁЯУЛ р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕З: р╣Бр╕Ьр╕Щр╕Бр╕▓р╕гр╕вр╣Йр╕▓р╕в Single-Tenant

**р╕зр╕▒р╕Щр╕Чр╕╡р╣И**: 3 р╕Бр╕╕р╕бр╕ар╕▓р╕Юр╕▒р╕Щр╕Шр╣М 2026
**р╕кр╕Цр╕▓р╕Щр╕░**: тЪая╕П р╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕Зр╕кр╕╣р╕З - р╕Хр╣Йр╕нр╕Зр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╣Ир╕нр╕Щр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г

---

## ЁЯОп р╕кр╕гр╕╕р╕Ыр╣Бр╕Ьр╕Щ

**р╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕в**: р╕вр╣Йр╕▓р╕вр╕Ир╕▓р╕Бр╕кр╕Цр╕▓р╕Ыр╕▒р╕Хр╕вр╕Бр╕гр╕гр╕б Multi-Tenant (SENA + SEN X р╣Бр╕вр╕Бр╕Бр╕▒р╕Щ) р╣Др╕Ыр╣Ар╕Ыр╣Зр╕Щ Single-Tenant (р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф Tenant ID: 1) р╣Вр╕Фр╕вр╣Гр╕Кр╣Й Organization/Department р╣Бр╕вр╕Б

**р╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З**:
- тЬЕ р╕гр╕░р╕Ър╕Ъ login р╣Ар╕Фр╕╡р╕вр╕з (р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕ер╕╖р╕нр╕Б tenant)
- тЬЕ Admin р╣Ар╕лр╣Зр╕Щр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕Чр╕╡р╣Ир╣Ар╕Фр╕╡р╕вр╕з
- тЬЕ р╕бр╕нр╕Ър╕лр╕бр╕▓р╕вр╕Зр╕▓р╕Щр╕Вр╣Йр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕гр╣Др╕Фр╣Йр╕Зр╣Ир╕▓р╕вр╕Вр╕╢р╣Йр╕Щ
- тЬЕ р╕вр╕▒р╕Зр╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Бр╕вр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕гр╣Гр╕Щр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Др╕Фр╣Й

---

## ЁЯЪи р╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕Зр╕зр╕┤р╕Бр╕др╕Х

### 1. тЪая╕П **р╕Др╕зр╕▓р╕бр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕Вр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е - Record р╕Чр╕╡р╣Ир╕кр╕╣р╕Нр╕лр╕▓р╕в**

**р╕Ыр╕▒р╕Нр╕лр╕▓**: р╣Бр╕Ьр╕Щр╕Ър╕нр╕Бр╕зр╣Ир╕▓ "р╕вр╣Йр╕▓р╕в Users р╣Др╕Ыр╕вр╕▒р╕З Tenant 1 р╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з" р╣Бр╕Хр╣Ир╣Др╕бр╣Ир╣Др╕Фр╣Йр╕Ър╕▒р╕Нр╕Кр╕╡р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕З

**р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ**:
- тЭУ **Jobs** - р╕Зр╕▓р╕Щр╕Чр╕╡р╣И requester_id / assignee_id р╣Ар╕Ыр╣Зр╕Щр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й Tenant 2 (р╕вр╕▒р╕Зр╕Др╕Зр╕нр╕вр╕╣р╣Ир╕Чр╕╡р╣И tenant_id = 2 р╕лр╕гр╕╖р╕нр╣Ар╕Ыр╕ер╣Ир╕▓?)
- тЭУ **Approvals** - р╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕Зр╣Др╕Ыр╕вр╕▒р╕Зр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Чр╕╡р╣Ир╕вр╣Йр╕▓р╕вр╣Бр╕ер╣Йр╕з
- тЭУ **User Scope Assignments** - р╕Бр╕▓р╕гр╕бр╕нр╕Ър╕лр╕бр╕▓р╕вр╕Вр╕нр╕Ър╣Ар╕Вр╕Х (р╕Цр╣Йр╕▓р╣Гр╕Кр╣Й scope_level='TENANT')
- тЭУ **Activity Logs, Job Comments, Notifications** - р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕б
- тЭУ **Project Job Assignments** - р╕Бр╕▓р╕гр╕бр╕нр╕Ър╕лр╕бр╕▓р╕вр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Зр╕▓р╕Щр╣Др╕Ыр╕вр╕▒р╕Зр╣Вр╕Др╕гр╕Зр╕Бр╕▓р╕г

**р╕Ьр╕ер╕Бр╕гр╕░р╕Чр╕Ъ**: Record р╕Чр╕╡р╣Ир╕Др╣Йр╕▓р╕Зр╕ер╕нр╕вр╕Ир╕▓р╕Б Tenant 2 р╕лр╕гр╕╖р╕нр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╣Ар╕бр╕╖р╣Ир╕н query р╕Зр╕▓р╕Щр╕Хр╕▓р╕бр╣Бр╕Хр╣Ир╕ер╕░ tenant

**р╕зр╕┤р╕Шр╕╡р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ**:
```sql
-- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕вр╣Йр╕▓р╕вр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕гр╕Ър╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
SELECT 'jobs' as table_name, COUNT(*)
FROM jobs
WHERE tenant_id = 2 AND requester_id IN (SELECT id FROM users WHERE tenant_id = 1);

SELECT 'approvals' as table_name, COUNT(*)
FROM approvals
WHERE tenant_id = 2 AND approver_id IN (SELECT id FROM users WHERE tenant_id = 1);

-- р╕Чр╕│р╣Ар╕Кр╣Ир╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╕Бр╕▒р╕Ъ: job_attachments, job_comments, notifications, user_scope_assignments
```

---

### 2. ЁЯФР **RLS Policy р╕нр╕▓р╕Ир╕Юр╕▒р╕З**

**р╕Ыр╕▒р╕Нр╕лр╕▓**: PostgreSQL RLS (Row Level Security) р╣Гр╕Щр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Бр╕│р╕лр╕Щр╕Фр╣Др╕зр╣Йр╕зр╣Ир╕▓:
```sql
WHERE tenant_id = current_setting('app.tenant_id')::int
```

**р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Ир╕░р╣Ар╕Бр╕┤р╕Фр╕Вр╕╢р╣Йр╕Щ**:
- тЬЕ Users р╕Чр╕╡р╣Ир╕вр╣Йр╕▓р╕вр╣Др╕Ы Tenant 1 р╕Ир╕░р╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕Фр╣Йр╕Хр╕▓р╕бр╕Ыр╕Бр╕Хр╕┤
- тЭМ **р╣Бр╕Хр╣И** RLS р╕Ир╕░р╣Др╕бр╣Ир╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╣Йр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕г (SENA р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕лр╣Зр╕Щ SEN X р╣Др╕Фр╣Й)
- тЭМ р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕В RLS policies р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕Кр╣Й `department_id` р╕лр╕гр╕╖р╕н `bud_id` р╣Бр╕Чр╕Щ

**RLS Policy р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕зр╣Ир╕▓**:
```sql
-- тЭМ р╕Ыр╕▒р╕Нр╕лр╕▓: р╣Гр╕Кр╣Йр╣Ар╕Юр╕╡р╕вр╕З tenant_id
WHERE tenant_id = current_setting('app.tenant_id')::int
```

**RLS Policy р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕В**:
```sql
-- тЬЕ р╣Бр╕Бр╣Йр╣Др╕В: р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Бр╕гр╕нр╕З department/bud
WHERE department_id IN (
  SELECT id FROM departments
  WHERE tenant_id = 1
    AND bud_id IN (
      SELECT bud_id FROM user_scope_assignments
      WHERE user_id = current_setting('app.user_id')::int
        AND scope_level = 'BUD'
    )
)
```

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕В**:
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ RLS policies р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е
2. р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Гр╕лр╣Йр╕Бр╕гр╕нр╕Зр╕Хр╕▓р╕бр╕кр╕▓р╕Вр╕▓/р╣Бр╕Ьр╕Щр╕Б (Department/BUD)
3. р╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓ SENA р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕лр╣Зр╕Щ SEN X р╣Др╕Фр╣Й

---

### 3. ЁЯУз **р╕Вр╣Йр╕нр╕Ир╕│р╕Бр╕▒р╕Ф Uniqueness р╕Вр╕нр╕Зр╕нр╕╡р╣Ар╕бр╕е**

**р╕Ыр╕▒р╕Нр╕лр╕▓**: Schema р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ:
```prisma
@@unique([tenantId, email])  // р╕нр╕╡р╣Ар╕бр╕ер╕Хр╣Йр╕нр╕Зр╣Др╕бр╣Ир╕Лр╣Йр╕│ р╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░ tenant
```

р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕вр╣Йр╕▓р╕в р╣Ар╕гр╕▓р╕Хр╣Йр╕нр╕Зр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И:

**р╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Б A: Uniqueness р╣Бр╕Ър╕Ъ Global** (р╣Др╕бр╣Ир╣Бр╕Щр╕░р╕Щр╕│)
```prisma
@@unique(email)  // тЭМ р╣Бр╕Хр╣Ир╕Цр╣Йр╕▓ SENA р╣Бр╕ер╕░ SEN X р╕бр╕╡ test@example.com р╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Бр╕▒р╕Щ?
```

**р╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Б B: р╣Ар╕Бр╣Зр╕Ър╣Ар╕Фр╕┤р╕б** (р╣Бр╕Щр╕░р╕Щр╕│)
```prisma
@@unique([tenantId, email])  // тЬЕ р╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Й р╣Бр╕Хр╣И verify р╣Др╕бр╣Ир╕бр╕╡р╕Лр╣Йр╕│р╕Вр╣Йр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕г
```

**р╕зр╕┤р╕Шр╕╡р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ**:
```sql
-- р╕лр╕▓р╕нр╕╡р╣Ар╕бр╕ер╕Чр╕╡р╣Ир╕Лр╣Йр╕│р╕Бр╕▒р╕Щр╕Вр╣Йр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕г
SELECT email, COUNT(*) as count
FROM users
GROUP BY email
HAVING COUNT(*) > 1;
```

---

### 4. ЁЯФН **р╣Др╕бр╣Ир╕бр╕╡ Organization Filtering р╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ**

**р╕Ыр╕▒р╕Нр╕лр╕▓**: р╣Бр╕Ьр╕Щр╕Ър╕нр╕Бр╕зр╣Ир╕▓ "р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╣Ар╕гр╕╡р╕вр╕Б API р╣Гр╕Кр╣Й Organization filtering" р╣Бр╕Хр╣И **р╣Др╕бр╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ир╕гр╕┤р╕З**

**р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ**:
```
Tenant (ID: 1)
  тФФтФАтФА Bud / BUS (SENA, SEN X)
      тФФтФАтФА Department (р╣Бр╕Ьр╕Щр╕Б)
          тФФтФАтФА Users
```

**Code Backend р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ** [backend/api-server/src/services/userService.js:144](../backend/api-server/src/services/userService.js#L144):
```javascript
const where = { tenantId };  // тЬЕ р╣Гр╕Кр╣Й tenantId
// тЭМ р╣Бр╕Хр╣Ир╣Др╕бр╣Ир╕бр╕╡ bud_id р╕лр╕гр╕╖р╕н department_id filtering
```

**р╕Др╕│р╕Цр╕▓р╕бр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Хр╕нр╕Ъ**:
- тЭУ SENA users р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ SEN X users р╣Др╕лр╕б?
- тЭУ SENA user р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕бр╕нр╕Ър╕лр╕бр╕▓р╕вр╕Зр╕▓р╕Щр╣Гр╕лр╣Й SEN X user р╣Др╕Фр╣Йр╣Др╕лр╕б?
- тЭУ Frontend р╕бр╕╡ "Organization filter" р╣Др╕лр╕б?

**р╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ API р╣Ар╕лр╕ер╣Ир╕▓р╕Щр╕╡р╣Й**:
- `GET /users` - р╕Др╕зр╕гр╕Бр╕гр╕нр╕Зр╕Хр╕▓р╕б bud/department
- `GET /jobs` - р╕Др╕зр╕гр╣Бр╕кр╕Фр╕Зр╣Ар╕Йр╕Юр╕▓р╕░р╕Зр╕▓р╕Щр╕Вр╕нр╕З organization р╕Щр╕▒р╣Йр╕Щ
- `POST /jobs/:id/assign` - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕вр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕нр╕Зр╕Др╣Мр╕Бр╕гр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
- Reports UI - р╕бр╕╡ "Organization filter" р╣Др╕лр╕б?

---

### 5. ЁЯФЧ **Foreign Key / Referential Integrity**

**р╕Ыр╕▒р╕Нр╕лр╕▓**:
- тЬЕ Users р╕Ир╕▓р╕Б Tenant 2 р╕Цр╕╣р╕Бр╕вр╣Йр╕▓р╕вр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕н?
- тЭУ Soft delete (is_active = false) р╕лр╕гр╕╖р╕н hard delete?
- тЭУ Jobs/Approvals р╕Вр╕нр╕Зр╣Ар╕Бр╣Ир╕▓ record р╕вр╕▒р╕З orphaned р╕нр╕вр╕╣р╣Ир╣Др╕лр╕б?

**р╕зр╕┤р╕Шр╕╡р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ**:
```sql
-- р╕Фр╕╣ Tenant 2 users р╕вр╕▒р╕Зр╕нр╕вр╕╣р╣Ир╣Др╕лр╕б
SELECT COUNT(*) FROM users WHERE tenant_id = 2;

-- р╕Фр╕╣ jobs р╕Чр╕╡р╣И tenant_id = 2
SELECT COUNT(*) FROM jobs WHERE tenant_id = 2;
```

**р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╕бр╕╡ Tenant 2 data**:
- тЬЕ р╕Хр╣Йр╕нр╕Зр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╕зр╣Ир╕▓ hard delete р╕лр╕гр╕╖р╕н soft delete
- тЬЕ р╕Хр╣Йр╕нр╕Зр╕нр╕▒р╕Ыр╣Ар╕Фр╕Х ALL dependent records р╣Ар╕Ыр╣Зр╕Щ tenant_id = 1

---

## тЪая╕П р╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕Зр╕кр╕╣р╕З

### 6. **р╕Др╕зр╕▓р╕бр╕Лр╕▒р╕Ър╕Лр╣Йр╕нр╕Щр╕Вр╕нр╕З Scope Assignment**

**р╕Ыр╕▒р╕Нр╕лр╕▓**: р╕Хр╕▓р╕гр╕▓р╕З `user_scope_assignments` р╕бр╕╡:
```sql
scope_level: 'TENANT' | 'BUD' | 'PROJECT'
```

**р╕Др╕│р╕Цр╕▓р╕б**: р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕гр╕зр╕б Tenant р╣Бр╕ер╣Йр╕з `scope_level='TENANT'` р╕Др╕╖р╕нр╕нр╕░р╣Др╕г?
- тЭУ р╕Чр╕╕р╕Б user р╣Гр╕Щ Tenant 1 р╕бр╕╡р╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕З SENA + SEN X?
- тЭУ р╕лр╕гр╕╖р╕нр╕Др╕зр╕гр╣Гр╕Кр╣Й BUD-level assignments р╣Бр╕Чр╕Щ?

**р╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕З**: р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕нр╕нр╕Бр╣Бр╕Ър╕Ър╣Гр╕лр╣Йр╕Фр╕╡ р╕нр╕▓р╕Ир╣Гр╕лр╣Йр╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╕бр╕▓р╕Бр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы

---

### 7. ЁЯзк **р╣Др╕бр╣Ир╕бр╕╡ UI Test Plan р╕кр╕│р╕лр╕гр╕▒р╕Ъ Organization Isolation**

р╣Бр╕Ьр╕Щр╕Бр╕▓р╕гр╣Др╕бр╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕лр╕ер╣Ир╕▓р╕Щр╕╡р╣Й:
- тЬЕ SENA Admin р╣Ар╕лр╣Зр╕Щ SEN X users р╣Др╕лр╕б? (р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щр╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╣Ар╕лр╣Зр╕Щ?)
- тЬЕ SENA user р╕кр╕гр╣Йр╕▓р╕Зр╕Зр╕▓р╕Щр╣Гр╕лр╣Й SEN X user р╣Др╕Фр╣Йр╣Др╕лр╕б? (Business rule?)
- тЬЕ Reports р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕Хр╣Ир╕ер╕░р╕нр╕Зр╕Др╣Мр╕Бр╕гр╕нр╕вр╣Ир╕▓р╕Зр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Др╕лр╕б?

---

## ЁЯУЛ Checklist р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г

### Phase 1: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ ALL records р╣Др╕Фр╣Йр╕вр╣Йр╕▓р╕вр╣Др╕Ыр╕вр╕▒р╕З Tenant 1 (jobs, approvals, etc.)
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Лр╣Йр╕│р╕Вр╕нр╕З email р╕Вр╣Йр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕г
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Tenant 2 data р╕вр╕▒р╕Зр╕бр╕╡р╕нр╕вр╕╣р╣Ир╕лр╕гр╕╖р╕нр╣Ар╕Ыр╕ер╣Ир╕▓
- [ ] р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е (backup) р╣Ар╕Хр╣Зр╕бр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е

### Phase 2: р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х Infrastructure
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х RLS policies р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
- [ ] р╕Чр╕Фр╕кр╕нр╕Ъ RLS policies р╣Гр╕лр╕бр╣Ир╕зр╣Ир╕▓р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╣Йр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕г
- [ ] р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З auth service р╣Гр╕лр╣Й simplified

### Phase 3: Frontend Implementation
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╣Ар╕Юр╕┤р╣Ир╕б organization/bud filtering р╣Гр╕Щ User Management
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╣Ар╕Юр╕┤р╣Ир╕б organization/bud filtering р╣Гр╕Щ Job Assignment
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╣Ар╕Юр╕┤р╣Ир╕б organization filter р╣Гр╕Щ Reports
- [ ] р╕ер╕Ъ tenantId selection р╕Ир╕▓р╕Б LoginV2.tsx

### Phase 4: Testing р╣Бр╕Ър╕Ър╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф
- [ ] тЬЕ р╕ер╕нр╕З login р╕Фр╣Йр╕зр╕в admin@test.com (р╕Др╕зр╕гр╣Ар╕Ыр╣Зр╕Щ Tenant 1)
- [ ] тЬЕ р╕ер╕нр╕Зр╕Фр╕╣ User List (р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ users р╕Чр╕▒р╣Йр╕Зр╕кр╕нр╕Зр╕нр╕Зр╕Др╣Мр╕Бр╕г р╕лр╕гр╕╖р╕нр╣Ар╕Йр╕Юр╕▓р╕░р╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕З?)
- [ ] тЬЕ р╕ер╕нр╕Зр╕бр╕нр╕Ър╕лр╕бр╕▓р╕вр╕Зр╕▓р╕Щр╕Вр╣Йр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕г (р╕Др╕зр╕гр╕кр╕│р╣Ар╕гр╣Зр╕Ир╕лр╕гр╕╖р╕нр╕Цр╕╣р╕Бр╕Ыр╕Пр╕┤р╣Ар╕кр╕Ш?)
- [ ] тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Reports р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕вр╣Ир╕▓р╕Зр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [ ] тЬЕ р╕Чр╕Фр╕кр╕нр╕Ъ RLS р╕зр╣Ир╕▓ SENA р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕лр╣Зр╕Щ SEN X р╣Др╕Фр╣Й

### Phase 5: Rollback Readiness
- [ ] р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Хр╣Зр╕бр╕Бр╣Ир╕нр╕Щр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г
- [ ] р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣М rollback р╕кр╕│р╕лр╕гр╕▒р╕Ъ users
- [ ] р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣М rollback р╕кр╕│р╕лр╕гр╕▒р╕Ъ ALL dependent tables

---

## ЁЯОп р╕кр╕гр╕╕р╕Ыр╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕З

| р╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕З | р╕гр╕░р╕Фр╕▒р╕Ъ | р╕кр╕▓р╣Ар╕лр╕Хр╕╕ | р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕В |
|----------|------|--------|---------|
| Data Integrity | ЁЯФ┤ р╕зр╕┤р╕Бр╕др╕Х | р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕вр╣Йр╕▓р╕в ALL records | р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф |
| RLS Policy Breakage | ЁЯФ┤ р╕зр╕┤р╕Бр╕др╕Х | RLS р╣Гр╕Кр╣Йр╣Ар╕Юр╕╡р╕вр╕З tenant_id | р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х RLS policies |
| Email Uniqueness | ЁЯЯа р╕кр╕╣р╕З | р╕нр╕▓р╕Ир╕бр╕╡р╕Лр╣Йр╕│р╕Вр╣Йр╕▓р╕б tenant | Verify + dedup |
| Org Filtering | ЁЯЯа р╕кр╕╣р╕З | р╣Др╕бр╣Ир╕бр╕╡ code audit | Audit + implement |
| Scope Level | ЁЯЯб р╕Ыр╕▓р╕Щр╕Бр╕ер╕▓р╕З | р╕Др╕зр╕▓р╕бр╕кр╕▒р╕Ър╕кр╕Щр╕Вр╕нр╕З TENANT level | р╕нр╕нр╕Бр╣Бр╕Ър╕Ър╣Гр╕лр╕бр╣И |
| Testing | ЁЯЯб р╕Ыр╕▓р╕Щр╕Бр╕ер╕▓р╕З | р╣Др╕бр╣Ир╕бр╕╡ UI test plan | р╣Ар╕Юр╕┤р╣Ир╕б test cases |

---

## ЁЯТб р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│

**тЬЕ р╕кр╕▓р╕бр╕▓р╕гр╕Ц proceed р╣Др╕Фр╣Й р╕лр╕▓р╕Бр╕Ыр╕Пр╕┤р╕Ър╕▒р╕Хр╕┤р╕Хр╕▓р╕б:**
1. тЬЕ Phase 1-2 р╕нр╕Ър╕гр╕б: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е + RLS
2. тЬЕ Phase 3-4: Implement + Test р╕нр╕вр╣Ир╕▓р╕Зр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф
3. тЬЕ Phase 5: р╕бр╕╡ backup + rollback plan

**тЭМ р╕нр╕▒р╕Щр╕Хр╕гр╕▓р╕вр╕Цр╣Йр╕▓:**
- тЭМ р╕Вр╣Йр╕▓р╕бр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Phase 1
- тЭМ р╣Др╕бр╣Ир╕нр╕▒р╕Ыр╣Ар╕Фр╕Х RLS policies
- тЭМ р╣Др╕бр╣Ир╕Чр╕Фр╕кр╕нр╕Ъ organization isolation
- тЭМ Deploy р╣Вр╕Фр╕вр╣Др╕бр╣Ир╕бр╕╡ backup

---

## ЁЯУЮ Contact & Questions

**р╕Др╕│р╕Цр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Хр╕нр╕Ър╕Бр╣Ир╕нр╕Щ**:
1. SENA users р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ SEN X users р╣Др╕лр╕б?
2. р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕бр╕нр╕Ър╕лр╕бр╕▓р╕вр╕Зр╕▓р╕Щр╕Вр╣Йр╕▓р╕бр╕нр╕Зр╕Др╣Мр╕Бр╕гр╣Др╕Фр╣Йр╣Др╕лр╕б?
3. р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Бр╕вр╕Б reports р╕Хр╕▓р╕б organization р╣Др╕лр╕б?
4. Scope 'TENANT' level р╕вр╕▒р╕Зр╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Йр╣Др╕лр╕б?

**р╣Ар╕нр╕Бр╕кр╕▓р╕гр╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕З**:
- Database Schema: [schema.prisma](../backend/prisma/schema.prisma)
- Auth Service: [auth.js](../backend/api-server/src/routes/auth.js)
- User Service: [userService.js](../backend/api-server/src/services/userService.js)

---

*р╣Ар╕нр╕Бр╕кр╕▓р╕гр╕Щр╕╡р╣Йр╣Ар╕Вр╕╡р╕вр╕Щр╣Ар╕бр╕╖р╣Ир╕н: 3 р╕Б.р╕Ю. 2026*
